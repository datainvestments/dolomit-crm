// DolomitPulse CRM — i18n + простой SPA-скелет
const I18N = {
  ru: {
    brand: "DolomitPulse CRM",
    language: "Язык",
    menu_dashboard: "Дашборд",
    menu_deals: "Сделки",
    menu_contacts: "Контакты",
    menu_companies: "Компании",
    menu_signals: "Мониторинг рынка",
    menu_documents: "Документы",
    menu_referrals: "Рефералы",
    menu_settings: "Настройки",
    footer_note: "MVP: CRM + мониторинг + рефералы + документы",
    title_dashboard: "Дашборд",
    btn_new: "Создать",
    btn_export: "Экспорт",
    kpi_deals: "Сделки",
    kpi_deals_s: "в работе",
    kpi_contacts: "Контакты",
    kpi_contacts_s: "в базе",
    kpi_signals: "Сигналы",
    kpi_signals_s: "новые",
    kpi_points: "Очки",
    kpi_points_s: "геймификация",
    quick_start: "Быстрый старт",
    qs1: "Добавьте компанию покупателя и поставщика",
    qs2: "Создайте сделку по доломиту (объем, цена, Incoterms)",
    qs3: "Загрузите LOI/контракт в документы",
    qs4: "Создайте реферальную ссылку и отслеживайте лидов",
  },
  kk: {
    brand: "DolomitPulse CRM",
    language: "Тіл",
    menu_dashboard: "Басқару панелі",
    menu_deals: "Мәмілелер",
    menu_contacts: "Байланыстар",
    menu_companies: "Компаниялар",
    menu_signals: "Нарықты мониторинг",
    menu_documents: "Құжаттар",
    menu_referrals: "Рефералдар",
    menu_settings: "Баптаулар",
    footer_note: "MVP: CRM + мониторинг + рефералдар + құжаттар",
    title_dashboard: "Басқару панелі",
    btn_new: "Құру",
    btn_export: "Экспорт",
    kpi_deals: "Мәмілелер",
    kpi_deals_s: "жұмыста",
    kpi_contacts: "Байланыстар",
    kpi_contacts_s: "базада",
    kpi_signals: "Сигналдар",
    kpi_signals_s: "жаңа",
    kpi_points: "Ұпайлар",
    kpi_points_s: "геймификация",
    quick_start: "Жылдам бастау",
    qs1: "Сатып алушы және жеткізуші компанияны қосыңыз",
    qs2: "Доломит мәмілесін жасаңыз (көлем, баға, Incoterms)",
    qs3: "LOI/келісімшартты құжаттарға жүктеңіз",
    qs4: "Реферал сілтемесін жасап, лидтерді бақылаңыз",
  },
  ky: {
    brand: "DolomitPulse CRM",
    language: "Тил",
    menu_dashboard: "Башкы панель",
    menu_deals: "Бүтүмдөр",
    menu_contacts: "Контактылар",
    menu_companies: "Компаниялар",
    menu_signals: "Рынок мониторинги",
    menu_documents: "Документтер",
    menu_referrals: "Рефералдар",
    menu_settings: "Орнотуулар",
    footer_note: "MVP: CRM + мониторинг + реферал + документ",
    title_dashboard: "Башкы панель",
    btn_new: "Түзүү",
    btn_export: "Экспорт",
    kpi_deals: "Бүтүмдөр",
    kpi_deals_s: "иште",
    kpi_contacts: "Контактылар",
    kpi_contacts_s: "базада",
    kpi_signals: "Сигналдар",
    kpi_signals_s: "жаңы",
    kpi_points: "Упайлар",
    kpi_points_s: "геймификация",
    quick_start: "Тез старт",
    qs1: "Сатып алуучу жана жеткирүүчү компанияны кошуңуз",
    qs2: "Доломит бүтүмүн түзүңүз (көлем, баа, Incoterms)",
    qs3: "LOI/келишимди документтерге жүктөңүз",
    qs4: "Реферал шилтемесин түзүп, лидтерди көзөмөлдөңүз",
  },
  en: {
    brand: "DolomitPulse CRM",
    language: "Language",
    menu_dashboard: "Dashboard",
    menu_deals: "Deals",
    menu_contacts: "Contacts",
    menu_companies: "Companies",
    menu_signals: "Market monitoring",
    menu_documents: "Documents",
    menu_referrals: "Referrals",
    menu_settings: "Settings",
    footer_note: "MVP: CRM + monitoring + referrals + documents",
    title_dashboard: "Dashboard",
    btn_new: "Create",
    btn_export: "Export",
    kpi_deals: "Deals",
    kpi_deals_s: "in progress",
    kpi_contacts: "Contacts",
    kpi_contacts_s: "in database",
    kpi_signals: "Signals",
    kpi_signals_s: "new",
    kpi_points: "Points",
    kpi_points_s: "gamification",
    quick_start: "Quick start",
    qs1: "Add buyer and supplier companies",
    qs2: "Create a dolomite deal (volume, price, Incoterms)",
    qs3: "Upload LOI/contract to documents",
    qs4: "Create a referral link and track leads",
  },
  zh: {
    brand: "白云石脉冲 CRM",
    language: "语言",
    menu_dashboard: "仪表盘",
    menu_deals: "交易",
    menu_contacts: "联系人",
    menu_companies: "公司",
    menu_signals: "市场监控",
    menu_documents: "文件",
    menu_referrals: "推荐",
    menu_settings: "设置",
    footer_note: "MVP：CRM + 监控 + 推荐 + 文件",
    title_dashboard: "仪表盘",
    btn_new: "创建",
    btn_export: "导出",
    kpi_deals: "交易",
    kpi_deals_s: "进行中",
    kpi_contacts: "联系人",
    kpi_contacts_s: "在库",
    kpi_signals: "信号",
    kpi_signals_s: "新的",
    kpi_points: "积分",
    kpi_points_s: "游戏化",
    quick_start: "快速开始",
    qs1: "添加买方与供应方公司",
    qs2: "创建白云石交易（数量、价格、Incoterms）",
    qs3: "上传 LOI/合同 到文件",
    qs4: "创建推荐链接并跟踪线索",
  }
};

const supported = ["ru","kk","ky","en","zh"];

function guessLang() {
  const saved = localStorage.getItem("dp_lang");
  if (saved && supported.includes(saved)) return saved;

  const nav = (navigator.language || "ru").toLowerCase();
  if (nav.startsWith("kk")) return "kk";
  if (nav.startsWith("ky")) return "ky";
  if (nav.startsWith("zh")) return "zh";
  if (nav.startsWith("en")) return "en";
  return "ru";
}

function applyI18n(lang) {
  const dict = I18N[lang] || I18N.ru;
  document.documentElement.lang = lang;
  document.title = dict.brand || "DolomitPulse CRM";

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const k = el.getAttribute("data-i18n");
    if (dict[k]) el.textContent = dict[k];
  });

  // Заголовок страницы
  const pageTitle = document.getElementById("pageTitle");
  if (pageTitle && dict["title_dashboard"]) pageTitle.textContent = dict["title_dashboard"];
}

function setLang(lang) {
  if (!supported.includes(lang)) lang = "ru";
  localStorage.setItem("dp_lang", lang);
  const select = document.getElementById("langSelect");
  if (select) select.value = lang;
  applyI18n(lang);
}

// Навигация по разделам (пока каркас)
function bindMenu() {
  document.querySelectorAll(".menu-item").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".menu-item").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      const view = btn.getAttribute("data-view");
      const pageTitle = document.getElementById("pageTitle");
      if (!pageTitle) return;

      const lang = localStorage.getItem("dp_lang") || "ru";
      const dict = I18N[lang] || I18N.ru;

      const map = {
        dashboard: dict.title_dashboard,
        deals: dict.menu_deals,
        contacts: dict.menu_contacts,
        companies: dict.menu_companies,
        signals: dict.menu_signals,
        documents: dict.menu_documents,
        referrals: dict.menu_referrals,
        settings: dict.menu_settings
      };
      pageTitle.textContent = map[view] || "DolomitPulse CRM";
    });
  });

  const select = document.getElementById("langSelect");
  if (select) {
    select.addEventListener("change", (e) => {
      setLang(e.target.value);
    });
  }
}

// KPI (пока демо)
function loadDemoKPIs() {
  const get = (k, d=0) => Number(localStorage.getItem(k) || d);
  document.getElementById("kpiDeals").textContent = get("kpi_deals", 0);
  document.getElementById("kpiContacts").textContent = get("kpi_contacts", 0);
  document.getElementById("kpiSignals").textContent = get("kpi_signals", 0);
  document.getElementById("kpiPoints").textContent = get("kpi_points", 0);
}

(function init(){
  bindMenu();
  loadDemoKPIs();
  setLang(guessLang());
})();
